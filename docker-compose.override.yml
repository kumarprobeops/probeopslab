# Development Docker Compose overrides
# This file is automatically loaded with docker-compose.yml
# Usage: docker compose up -d

services:
  app:
    build:
      context: ./app
      dockerfile: Dockerfile
    # Override command for hot-reload in development
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    volumes:
      # Mount app directory for hot-reload
      - ./app:/app
    # Expose port directly for debugging (optional)
    ports:
      - "8000:8000"

  nginx:
    volumes:
      # Use dev config (HTTP only, no TLS)
      - ./nginx/nginx.dev.conf:/etc/nginx/nginx.conf:ro
      # Mount certbot webroot for ACME challenges
      - ./certbot/www:/var/www/certbot:ro
    ports:
      # Only expose HTTP in dev
      - "80:80"
    # Override command to skip certificate reload
    command: "nginx -g 'daemon off;'"

  # Disable certbot in development
  certbot:
    profiles:
      - production
